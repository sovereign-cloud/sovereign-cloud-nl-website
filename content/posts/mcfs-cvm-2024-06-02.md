---
title: "Microsoft Cloud for Sovereignty - Part 6 - Confidential VM" # Title of the blog post.
date: 2024-06-03T16:12:35+01:00 # Date of post creation.
description: "Microsoft Cloud for Sovereignty - Part 6 - Confidential VM" # Description used for search engine.
featured: false # Sets if post is a featured post, making appear on the home page side bar.
draft: false # Sets whether to render this page. Draft of true will not be rendered.
toc: false # Controls if a table of contents should be generated for first-level links automatically.
# menu: main
usePageBundles: false # Set to true to group assets like images in the same folder as this post.
# featureImage: "/images/ignite.png" # Sets featured image on blog post.
# featureImageAlt: 'DockerCon 2018' # Alternative text for featured image.
# featureImageCap: 'This is the featured image.' # Caption (optional).
thumbnail: "/images/scbs6.png" # Sets thumbnail image appearing inside card on homepage.
# shareImage: "/images/DockerCon2018.png" # Designate a separate image for social media sharing.
codeMaxLines: 10 # Override global value for how many lines within a code block before auto-collapsing.
codeLineNumbers: false # Override global value for showing of line numbers within code block.
figurePositionShow: true # Override global value for showing the figure label.
categories:
  - Technology
  - Microsoft
tags:
  - Privacy
  - Residency
  - Sovereignty
  - Protection & Management
  - Security 
# comment: false # Disable comment if false.
---
<B>Azure confidential VMs</b> <br>
This blog will give you an overview about Azure confidential VMs, one of the offerings of Azure Confidential Computing (ACC). This information can be found at <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-vm-overview">Microsoft Learn</a>.

<Br>

<B>What are Azure confidential VMs</B> <br>
Confidential VMs are an IaaS solution for tenants with high security and confidentiality requirements. Confidential VMs offer:
  - Encryption for "data in use”, including the processor state and the virtual machine’s memory. The keys are generated by the processor and never leave it.<br>
  - Host attestation helps you verify the full health and compliance of the server before data processing begins.<br>
  - Hardware Security Module (HSM) can be attached to guard the keys of confidential VM disks, which the tenant exclusively owns.<br>
  - New UEFI boot architecture supporting the guest OS for enhanced security settings and capabilities.<br>
  - A dedicated virtual Trusted Platform Module (TPM) certifies the health of the VM, provides hardened key management, and supports use cases such as BitLocker. <br>
  
In this <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-vm-overview">video</a>, Microsoft explains in visuals what Confidential VMs brings you. It gives protection against root kits, the Azure services, the Azure hypervisor and Datacenter Admins. Confidential VMs are the easiest way to migrate traditional applications, because teh complete VM will be encrypted.

<img src="/images/mcfs14.png" width="600" height="800">
<br>

<B>Why use Confidential VMs</B> <br>
  - Confidential VMs address customer concerns about moving sensitive workloads off-premise into the cloud. Confidential VMs provide elevated protections for customer data from the underlying infrastructure and cloud operators. Unlike other approaches and solutions, you don't have to adapt your existing workloads to fit the platform's technical needs; <br>
  - Robust hardware-based isolation between virtual machines, hypervisor, and host management code; <br>
  - Customizable attestation policies to ensure the host's compliance before deployment; <br>
  - Cloud-based Confidential OS disk encryption before the first boot; <br>
  - VM encryption keys that the platform or the customer (optionally) owns and manages; <br>
  - Secure key release with cryptographic binding between the platform's successful attestation and the VM's encryption keys; <br>
  - Dedicated virtual Trusted Platform Module (TPM) instance for attestation and protection of keys and secrets in the virtual machine; <br>
  - Secure boot capability similar to Trusted launch for Azure VMs. <br>

<br>

<B>Deepdive into Confidential VMs</B> <br>
If you are interested in more deepdive into Confidential VMs, click the following links for more information:
  - <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-vm-overview#confidential-os-disk-encryption">Confidential OS disk encryption</a> - which protects all critical partitions of the disk. It also binds disk encryption keys to the virtual machine's TPM and makes the protected disk content accessible only to the VM.; <br>
  - <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-vm-overview#confidential-temp-disk-encryption">Confidential temp disk encryption</a>; - which can be enabled. This feature is currently in <a href="https://techcommunity.microsoft.com/t5/azure-confidential-computing/confidential-temp-disk-encryption-for-confidential-vms-in-public/ba-p/3971393">Public Preview</a> .<br>
  - <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-vm-overview#attestation-and-tpm">Attestation and TPM</a> - which explains that Confidential VMs boot only after successful attestation of the platform's critical components and security settings; <br>
  - <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-vm-faq">Azure confidential virtual machines FAQ</a>; <br>
  - <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/virtual-tpms-in-azure-confidential-vm">Virtual TPMs in Azure confidential VMs explained</a>; <br>
  - <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/key-rotation-offline">How to rotate customer-managed keys for confidential VMs</a>. <br>

<img src="/images/mcfs9.png" width="600" height="800">

<br>

<B>Deployment</B> <br>
Deployment can be done via AzureCLI, PowerShell, bicep or via ARM. For more information, click <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/virtual-machine-options">here</a> to reach the Microsoft Learn documentation, to investigate the deployment considerations. You could also use the Confidential Virtual Machine Accelerator which can be found at this <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/virtual-machine-options">GitHub Repository</a>. Integration with Microsoft Defender for Cloud is possible and can be found <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/guest-attestation-defender-for-cloud">here</a>.

<br>

<B>Limitations</B> <br>
The following limitations exist for confidential VMs: <br>
  - <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/virtual-machine-options#sizes">VM SKU sizes</a>; <br>
  - <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-vm-overview#os-support">OS support</a>; <br>
  - <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/virtual-machine-options#regional-availability">Regional Support</a>; <br>
  - <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-vm-overview#feature-support">Feature Support</a>; <br>
  - <a href="https://azure.microsoft.com/nl-nl/updates/private-preview-azure-backup-support-for-confidential-vms-using-customer-managed-keys/">Azure Backup support for confidential VMs using Customer Managed Keys</a> which is currently in private preview; <br> 
  - <a href="https://learn.microsoft.com/en-us/azure/confidential-computing/virtual-machine-options#high-availability-and-disaster-recovery">High availability and disaster recovery</a> is the customer's responsibility; <br> 
  - Encryption to an extra Data disks is currently not supported.
  - Automatic rotating of Customer Managed Keys in combination with Azure Key Vault Managed HSM is currently not supported. This proces is manual by first shutdown the VM and then replace the HSM key. 


<br>


<br>

<B>Best practices for securing Managed HSM</B> <br>
Below, you will find the best practices for securing your Azure Key Vault Managed HSM key management system. For a full list of security recommendations, see the <a href="https://learn.microsoft.com/en-us/security/benchmark/azure/baselines/key-vault-managed-hsm-security-baseline">Azure Managed HSM security baseline</a>.
  - Control access to your managed HSM
      - Create a <a href="https://learn.microsoft.com/en-us/entra/fundamentals/concept-learn-about-groups">Microsoft Entra security group</a> for the HSM Administrators (instead of assigning the Administrator role to individuals) to prevent "administration lockout" if an individual account is deleted;
      - Lock down access to your management groups, subscriptions, resource groups, and managed HSMs. Use Azure role-based access control (Azure RBAC) to control access to your management groups, subscriptions, and resource groups.
      - Create per-key role assignments by using <a href="https://learn.microsoft.com/en-us/azure/key-vault/managed-hsm/access-control#data-plane-and-managed-hsm-local-rbac">Managed HSM local RBAC</a>.
      - To maintain separation of duties, avoid assigning multiple roles to the same principals.
      - Use the least-privilege access principle to assign roles.
      - Create a custom role definition by using a precise set of permissions.
  - Create backups
      - Be sure that you create regular <a href="https://learn.microsoft.com/en-us/azure/key-vault/managed-hsm/backup-restore">backups</a> of your managed HSM. You can create backups at the HSM level and for specific keys.
  - Turn on logging via Azure Policy
      - <a href="https://learn.microsoft.com/en-us/azure/key-vault/managed-hsm/logging">Turn on logging</a> for your HSM. You also can set up alerts.
  - Turn on recovery options
      - <a href="https://learn.microsoft.com/en-us/azure/key-vault/managed-hsm/soft-delete-overview">Soft-delete</a>, which results when the HSM is accidently is removed, it will be marked for deletion and removed after the retention time is reached. You can choose a retention period of between 7 and 90 days;
      - Purge protection, which to prevent immediate permanent deletion of the HSM or keys. When purge protection is on, the managed HSM or keys remain in a deleted state until the retention period has ended.
